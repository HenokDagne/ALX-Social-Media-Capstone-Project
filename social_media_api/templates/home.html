<!DOCTYPE html>
<html lang="en">
  <head>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/style.css' %}" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Home</title>
  </head>
  <body>
    <p>{{ message }}</p>

    <a href="/auth/jwt/create/">Login</a>
    <a href="/auth/users/">Register</a>
    <a href="http://localhost:8000/accounts/google/login/">Login with Google</a>
    <!-- Google OAuth link -->

    <!-- Logout button -->
    <form action="/auth/jwt/logout/" method="POST">
      <input
        type="hidden"
        name="csrfmiddlewaretoken"
        value="{{ csrf_token }}"
      />
      <button type="submit">Logout</button>
      <a href="/google-logout/">Logout</a>
    </form>
    <script>
      document
        .getElementById("logout-form")
        .addEventListener("submit", function (e) {
          e.preventDefault();
          const token = localStorage.getItem("refresh_token"); // Retrieve the refresh token from localStorage
          fetch("/auth/jwt/logout/", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Authorization: `Bearer ${localStorage.getItem("access_token")}`,
            },
            body: JSON.stringify({ refresh: token }),
          }).then((response) => {
            if (response.ok) {
              alert("Logged out successfully!");
              localStorage.removeItem("access_token"); // Remove tokens from localStorage
              localStorage.removeItem("refresh_token");
              window.location.href = "/"; // Redirect to the home page
            } else {
              alert("Logout failed!");
            }
          });
        });
    </script>
  </body>
</html>
